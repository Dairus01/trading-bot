import{A as L,u as T,a as b,t as g,s as M,b as B,R as E,j as e,L as C,c as D,d as W,B as y}from"./main-C8qZjRQu.js";import{r as o}from"./react-C2nHe5Yl.js";import{t as R}from"./truncateText-M_jpkIou.js";import{b as O}from"./cryptoLib-D3cA6VP7.js";import{u as U,d as q,e as F}from"./solanaWalletAdapters-B1k2ZJdH.js";import{u as N}from"./reactRouter-DK1sZJce.js";import"./utility-DARsLm--.js";const H=L.injectEndpoints({endpoints:a=>({login:a.mutation({query:i=>({url:"auth/login",method:"POST",body:i}),invalidatesTags:[]})}),overrideExisting:!1}),{useLoginMutation:P}=H,I=()=>{const[a,i]=o.useState(!1),{connecting:c,connected:f,signMessage:k,publicKey:n,disconnect:p}=U(),{visible:r}=q(),[x,{isLoading:_,error:h}]=P(),j=N(),l=T(),m=b(s=>s.auth.token),d=()=>{p(),i(!1),setTimeout(()=>{l(D()),l(W())},300)};o.useEffect(()=>{h&&d()},[h]),o.useEffect(()=>{!r&&!n&&!c&&!a&&d()},[r,n,a,c]),o.useEffect(()=>{!r&&!n&&!c&&i(!1)},[r,n,c]);const S=o.useCallback(async s=>{var u,w,v;try{const t=await x({publicKey:s==null?void 0:s.walletAddress,signature:s==null?void 0:s.signature}).unwrap();t&&(g.success("Login successful"),l(M((u=t==null?void 0:t.data)==null?void 0:u.user)),l(B((w=t==null?void 0:t.data)==null?void 0:w.jwt_token)),j(E.DASHBOARD))}catch(t){console.log("error",t),g.error(((v=t==null?void 0:t.data)==null?void 0:v.message)||"Failed to Login")}},[l,x,j]),A=async()=>{if(!n){g.warning("Wallet not connected!");return}try{const s=new TextEncoder().encode("Please sign this message to connect"),u=await k(s);S({walletAddress:n==null?void 0:n.toString(),signature:O.encode(u)})}catch(s){g.error((s==null?void 0:s.message)||"Signature request rejected"),d()}};return o.useEffect(()=>{f&&!m&&(console.log("token",m),i(!0),A())},[f,m]),e.jsx(e.Fragment,{children:e.jsxs(F,{style:{backgroundColor:"blue"},children:[!n&&!a?"Connect Wallet":null,n&&!a?`${R(n.toString(),6,8)}`:null,a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 animate-spin"}),"Connecting..."]})]})})},X=()=>{const a=N(),i=b(c=>c.auth.token);return o.useEffect(()=>{i&&a(E.DASHBOARD)},[i]),e.jsx("div",{className:"w-screen h-screen bg-gray-100",children:e.jsx("div",{className:"flex min-h-full flex-1 flex-col px-6 py-12s lg:px-8",children:e.jsxs("div",{className:"mt-14",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-sm",children:[e.jsx(y,{className:"h-24 w-24 mx-auto text-indigo-600"}),e.jsxs("h2",{className:"mt-10 text-center text-2xl/9 font-bold tracking-tight text-gray-600",children:["Sign in to your account by connecting your"," ",e.jsx("span",{className:"text-indigo-600 font-semibold",children:"wallet"})]})]}),e.jsx("div",{className:"mt-20 sm:mx-auto sm:w-full sm:max-w-xs",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(I,{})})})]})})})};export{X as default};
